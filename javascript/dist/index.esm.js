import{Controller as t}from"stimulus";function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var n=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).closeDropdowns=function(){e.element.classList.remove("is-active")},e}e(i,t);var n=i.prototype;return n.connect=function(){document.addEventListener("click",this.closeDropdowns)},n.disconnect=function(){document.removeEventListener("click",this.closeDropdowns)},n.toggleMenu=function(t){t.stopPropagation(),t.preventDefault(),this.element.classList.toggle("is-active")},i}(t),r=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.connect=function(){this.fieldsSelector=this.data.get("selector"),this.removeDuplicates=this.data.get("removeDuplicates"),this.isAtMaximumSize()&&this.buttonTarget.setAttribute("disabled",!0)},n.addFields=function(t){if(t.preventDefault(),this.isAtMaximumSize())return!1;this.setSize(this.getSize()+1);var e=this.removeDuplicates?this.templateFragmentWithoutDuplicates():this.templateFragment(),i=e.querySelector("[data-position]");i&&(i.value=this.getSize()),this.containerTarget.appendChild(e),this.isAtMaximumSize()&&this.buttonTarget.setAttribute("disabled",!0)},n.removeFields=function(t){t.preventDefault(),this.setSize(this.getSize()-1);var e,i,n=t.target.closest(this.fieldsSelector);n.style.display="none",i=function(t){"hidden"!==t.type&&t.remove()},(e=n).querySelectorAll("input").forEach(i),e.querySelectorAll("textarea").forEach(i),e.querySelectorAll("select").forEach(i),n.querySelector(".destroy-flag").value=!0,this.hasButtonTarget&&this.buttonTarget.hasAttribute("disabled")&&this.buttonTarget.removeAttribute("disabled")},n.moveUp=function(t){t.preventDefault();var e=t.target.closest(this.fieldsSelector),i=function(t,e){var i=t.previousElementSibling;if(!i)return null;for(;!i.matches(e);)if(!(i=i.previousElementSibling))return null;return i}(e,this.fieldsSelector);this.swapElements(e,i),this.resetPositionValues()},n.moveDown=function(t){t.preventDefault();var e=t.target.closest(this.fieldsSelector),i=function(t,e){var i=t.nextElementSibling;if(!i)return null;for(;!i.matches(e);)if(!(i=i.nextElementSibling))return null;return i}(e,this.fieldsSelector);this.swapElements(e,i),this.resetPositionValues()},n.swapElements=function(t,e){var i,n;null!=e&&(n=e.nextElementSibling,(i=t.parentNode).insertBefore(e,t.nextElementSibling),i.insertBefore(t,n))},n.resetPositionValues=function(){this.element.querySelectorAll(this.fieldsSelector).forEach(function(t,e){t.querySelector("[data-position]").value=e+1})},n.templateFragment=function(){return i=this.templateTarget,n=/new_record/g,o=Math.floor(100*Math.random()+1),r=(new Date).getTime().toString()+o,t=i.innerHTML.replace(n,r),(e=document.createElement("template")).innerHTML=t,e.content;var t,e,i,n,r,o},n.templateFragmentWithoutDuplicates=function(){var t=Array.from(this.element.querySelectorAll(this.fieldsSelector+" select")).map(function(t){return t.value}),e=this.templateFragment();return e.querySelectorAll("select option").forEach(function(e){t.includes(e.value)&&e.remove()}),e},n.dropdownOptionsSize=function(){return this.templateFragment().querySelectorAll("select option").length},n.isAtMaximumSize=function(){return this.removeDuplicates&&this.dropdownOptionsSize()===this.getSize()},n.getSize=function(){return parseInt(this.data.get("size"))},n.setSize=function(t){this.data.set("size",t)},i}(t);r.targets=["template","container","button"];export{n as DropdownController,r as DynamicFieldsController};
//# sourceMappingURL=index.esm.js.map
